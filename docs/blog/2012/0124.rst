20120124
========

Wie gut, dass ich das Release verschoben habe:

Lino hatte in der Tat ein gewaltiges Performance-Problem: ich hatte gedacht, 
dass wenn man `len()` von einem QuerySet macht, Django dies automatisch in 
einen entsprechenden "SELECT COUNT" konvertiert. Aber Pustekuchen, der 
machte dann jedesmal ein "SELECT * FROM Persons", und zwar ohne LIMIT. 
Und ich rief das ungeniert mehrere Male pro Request auf.

Interessant, dass mir das bei den Tests mit der Demo-Datenbank gar nicht 
aufgefallen war.
Erst bei 5000 Records machte es sich bemerkbar.

Um das rauszufinden, habe ich übrigens zunächst mal einen TestCase 
geschrieben: new module :mod:`lino.apps.dsbe.tests.dsbe_sql_tests`.

Das war nicht ganz leicht, eigentlich musste ich zunächst mal ein 
Test-Framework zum Testen der SQL-Queries aufbauen:
Added new class attribute 
:attr:`lino.utils.test.TestCase.defining_module` and
method :meth:`lino.utils.test.TestCase.check_sql_queries`.
Also fixed a little bug in :mod:`lino.utils.auth`.

Noch Kleinkram:

- Der Button mit den Benutzereinstellungen benutzte noch eine 
  url mit permalink statt javascript.
  
- ClientsTest prüft jetzt par défaut nur die aktiven Klienten.
  Wer alle prüfen will, muss das Datumsfeld auf leer setzen.
  
- Person.get_image_url() verlangt jetzt ein weiterens Argument `request`
  und gibt dafür jetzt auch dann den richtigen URL, wenn Lino nicht 
  im Root des Webservers installiert ist.
  
- Wenn man vom Detail einer Person aus auf die Lupe beim Feld "Stadt" 
  klickte um deren Detail zu öffnen, und dieses Fenster dann wieder schloss,
  dann kam in der Console::

    Uncaught TypeError: Object [object Object] has no method 'refresh'
    (anonymous function)                               lino_de.js:3257
    Lino.FormPanel.Ext.extend.do_when_clean            lino_de.js:1858
    Lino.Window.Ext.extend.hide                        lino_de.js:3246
    (anonymous function)                        ext-all-debug.js:17401
    h
  