Lino Diary 2003
===============

20030104 [lino]

- created tests/test_5.py


20030104 [timtools]

- added possibility to use sendmail to send pictures as attachments
  and to work without addrlist.txt
- added possibility to specify filename as wildcard on Windows using
  glob 
- Bug : if input file was in current directory, then user.log was
  written in "/user.log" instead of "./user.log"


20030106 [lino]

Braucht man mehrere Applikationen in einem einzigen Python-Runtime?
"For example if Lino runs as a HTTP-Server or as a Webware plugin,
there can be more than one application."

Alles wird einfacher, wenn ich dieses Feature raus werfe und mich voll
auf das Modul-Konzept von Python verlasse.
Table.link() und Table._declare() brauchen keinen Parameter app mehr.
def install(app) in den Plugins fällt weg.

Also lino.py ist ein Singleton-Objekt, das die bisherige app (eine
Instanz von Application) ersetzt. Die Plugins und alle anderen greifen
hard-codiert auf diesen Namen zu. Man kann also pro Python-Sitzung
Lino nur einmal instanzieren.

20030107 [lino]

Weiter mit den Änderungen von gestern.

Table.peek() returns a Row.
Cursor.peek() could also return a Row, but this time with the columns
specified in the Cursor.
Problem : the columnList is in fact a property of the Query.
So it should be Query.peek().
Hm...

20030108 [lino]

- run_tests läuft jetzt einigermaßen fehlerfrei, aber 
  das pickle_dbd scheint noch sehr buggy zu sein.

- Ich habe mir mxBeeBase von
  http://www.egenix.com/files/python/mxBeeBase.html runter geladen.
  Aber ich kann die Source-Distribution nicht installieren, weil er
  eine cl.exe will (also den MS-Compiler).



20030110 [timtools]

- Bug since 20030104 : I did not know that simply setting a header of
  a Message does not overwrite an existing header with the same key! I
  knew it only because Patrick's address has been disabled. In the
  failure notice I saw adresses of other recipients of my newsletter...


20030112 [lino]

- Jacques Delannay wrote "Si tu réécris ton programme, essaie
  d'utiliser une Database client-serveur car je commence à avoir de
  plus en plus de problème de faire tourner ma database ISAM sur les
  réseaux Windows."  I decided to freeze the pickle_dbd and to look
  once more for "Which SQL database for Python on Cygwin"

20030113 [lino]

- Wow : sqlite.exe is ideal for SQL students. No need to install. Just
  copy the sqlite.exe somewhere in your PATH. Then type

  sqlite test.sql

  This will open a full-blown SQL client session. Data is afterwards
  stored in test.sql.



20030123 [timtools]

- Some box characters were not converted to +, - or | so that the pdf
  document contained a ? for them.

  


20030217 [timtools] prn2pdf

- drawImage() mixed w and h so that you could print only quadratic
  images correctly.


  


20030306 [timtools]

- added a new tool "ptx2pdf".

  ptx files are basically python scripts, but a set of high-level
  markup functions based on ReportLab's PLATYPUS library is
  automatically defined.

  The tool is intented to by used by TIM users. TIM generates a ptx
  file from an invoice (for example) and then runs ptx2pdf on the
  generated file.

  
20030315 [timtools]

- renamed "ptx" to "pds" ("Python Document Script")
- directory tests
- file 3.pds
- file runme.py
- pds2pdf.py :
  - specify colWidths and colStyles for tables

- ich bin verwundert, dass in der reportlab-users niemand auch nur
  geantwortet hat auf meine styles.py. Unklar formuliert? Oder der
  falsche Stil? Naja... 

- styles.py : neue Methode StyleSheet1.create()


- Integrated the "TIM Tools" into Lino. 
  Impulse was my_import which I wanted to use in TIM Tools.
  Lino can currently be defined as "everything what I am doing in Python and parts of which can be distributed in binary form"


20030317 pds2pdf

- weiter mit Tabellen. New class TableHeader(). "Classical" tables are
  still possible, but then without any column width and styles.


20030323 sendmail

- Wenn sendmail.py Bilder verschickt, dann wird im header Content-Type
  jetzt das Attribut name=dateiname mit verschickt. Bei
  photos@@photo.epson.com wird so der Titel des Bildes angegeben.


20030324 lino

- added the reporter module (experimental). A Reporter represents a
  query on tablular data and holds information
  about how to present this data.
  - using a database connection
  - a Reporter has a list of columns, a list of totals and a list of
  groups. 

20030325 lino

- continued integration of Reporter, TextDocument, PdfDocument, ...

20030326

- continued with SimpleDocument in lino.sdoc.abstract. replaced
  nextCell() and nextRow() by endCell() and endRow() *or* beginCell()
  and beginRow()


20030331

- still not sure about how to name everything. "Lino" is not a good
  name for the whole library collection since Lino means "the
  successor of TIM". OTOH the sdoc package is is intended to be mor
  than just for the TIM tools.

- from lino.lib.expose import expose
  instead of from lino.common import all.

- from timtools.version import *

- sdoc/pdf.py : new methods drawPageHeader(), drawPageTopLeft(),
  drawPageTopRight().

- tests/pds2pdf/7.py : Random texts illustrates hte page headers

20030402

- Ha! Endlich eine elegante Lösung für mkdist gefunden : mkdist.bat
  startet den Installer auf einer Datei timtools.spec, die ja in
  Wirklichkeit ein Python Skript ist. Beinahe hätte ich den Installer
  umgeschrieben, damit man ihn von einem anderen Skript aus rufen
  kann. Dafür ist er nicht konzipiert (ruft z.B. sys.argv ab...)

- The tests directory becomes more clear. New function 
  lino.lib.tsttools.alltests()

  
20030403

- Bua! Den ganzen Tag lang am Gandalf gearbeitet!
  tests\gandalf\runme.py funktioniert erst halb, aber immerhin.

  Die Joins werden nicht richtig nach SQL übersetzt. Frage ist auch
  noch, wie die Daten physikalisch in der Row gespeichert werden.

  sql.py : getSqlSelect(), name2sql()
  row.py : __getattr__()
  
  

20030404

- tests/gandalf/20030404.py : Ich bin noch mal wieder über das interne
  Datenmodell von Gandalf am nachdenken...

- [timtools] : prn2pdf und pds2pdf jetzt mit hoffentlich definitiver
  Befehlszeilenschnittstelle:
  timtools pds2pdf [-o foo.pdf] bar.pds

  - Nur eine Inputdatei auf einmal ist erlaubt.
  
  - Die Erweiterung .pds (bzw. .prn) ist optional. Wenn keine
    Erweiterung, wird .pds drangehängt. Wenn eine andere Erweiterung
    als .pds : auch okay. Wenn -o, dann muss muss die Erweieterung
    .pdf mit angegeben werden.

- released timtools version 0.5 (Rocatec)

- timtools version 0.5.1 started

- timtools
  Noch was : wenn Erweiterung von outputfile nicht ".pdf" ist, dann
  wird jetzt ".pdf" an den Dateinamen gehängt.


20030406
20030407

- continued on getting tests/gandalf/20030404.py to work

20030408
20030409
20030410

- worked much on package sdoc.

20030411 sdoc

- tests/pds2pdf/ run again. And now you can nest tables.

20030411 timtools

- pds2pdf now checks for a file "__init__.pdf" in the same directory
  as the inputfile. If it exists, then it is executed before the
  inputfile.

- prn2pdf had a bug : if the ctrl command for Landscape was repeated
  at the beginning of each page (as it must be for text printers),
  then each even page was not rotated.

- prn2pdf now supports the command setLpi() (ESC "l<n> " where <n>
  should be 6, 7 or 8). If setLpi() is used in a document, then the
  leading is fixed (not depending on the font size).


20030412 

- released timtools 0.5.1 (bugfix)


20030413 sdoc

- Wow! tests/pds2pdf/20030413.pds (Page headers) funktioniert!

20030414

- Nochmal Umbenennungen :
  - Gandalf : the meta-project. (hieß bisher lino)
  - Lino : der TIM-Nachfolger (hieß bisher ebenfalls lino)
  - Adam : Abstract Database Application Model (hieß bisher Gandalf)
  
- Problem in woche.pds (siehe tests/pds2pdf/20030414.pds)
  
20030415

- 

20030422

- renamed "adam" to "adamo"

- tests/adamo/20030404.py ist mir jetzt endlich klar.
  "Introduction to the Abstract Data Model ADAMO."

20030423

- sdoc/tables.py : wenn Kolonnenbreiten automatisch berechnet wurden,
  dann konnte es später zu einer Exception in reportlab kommen, weil
  die gesamte Tabelle um ein Entchen zu breit war. Jetzt wird deshalb
  von allen Kolonnen ein epsilon (0.001Punkt) abgezogen.


20030505

- new file gandalf/sdoc/barcodes.py
- new command-method barcode(txt)

- Wow! tests/pds2pdf/20030505.pds shows something similar to a EAN13
  barcode. (To be continued: human-readable text... long bars must be
  longer than short bars... thickness of bars must be checked...

20030514

- barcodes continued. Not finished. TODO : Flowable.size() seems not
  correct. Test whether barcode scanner accepts printed symbols.
  Note : human-readable text is in Helvetica instead of OCR-B which is
  perhaps allowed.  


20030516

- barcodes continued.

- styles.py : all table styles now have default ALIGN 'LEFT' instead
  of 'RIGHT'

- Wow! tests/pds2pdf/runme.py generiert jetzt erstmals auch html! Zwar
  noch kein stolzes Layout... aber immerhin! Proof of concept.


20030519

- Started a major internal redesign of sdoc. The internal
  representation was too close to the reportlab view of things, which
  made it difficult to render HTML. The code is currently broken.


  
20030521

- Nein, das war teilweise ein falscher Weg: dass der PdfRenderer
  selber die Story macht (eine Story ist eine Serie von Flowables,
  Flowables sind Textstücke, deren Breite bekannt ist, die aber erst
  beim Rendern vertikal gesplittet werden). Der HtmlRenderer kommt
  nicht drumrum auch über eine Story und Flowables zu arbeiten, weil
  die TableInstance es sonst nicht auf die Reihe kriegt. Die Zellen
  sind lists of Flowables, und zwar auch für HTML, denn ich will, dass
  man mit restartRow() innerhalb einer Reihe auch rückwärts springen
  kann. Also aus einer älteren Version restoren: tables.py, html.py,
  pdf.py...



20030525

- environment.py : p, h1, h2, ... barcode sind jetzt in
  ElementContainer. Wo getRenderer() hin soll ist noch nicht klar. Die
  Renderer müssen noch die compileXxxx() wieder bekommen.

20030526

- Weiter in sdoc.  


20030529

- Weiter in sdoc.  

20030530

- Den ganzen Tag an sdoc gearbeitet. Bin wieder blockiert. Frust!

20030531

- sdoc. Das '</tr>' am Ende einer Row provoziert den Beginn der
  nächsten Row. Weil ein beginRow() am Anfang der Tabelle optional
  ist, wenn toStory() gemacht wird. Problem ist also, dass er sich an
  der Story verschluckt. Frage ist, ob ich das restartRow() wirklich
  unbedingt haben will. TIM benutzt es momentan, um Rechnungen zu
  drucken. Aber das ist sowieso nur ein Proof-of-concept, bisher ist
  das bei niemandem installiert.

- Ich stelle mir die Frage nach dem Sinn von sdoc. Bin ich noch das
  Fahrrad am erfinden, während alle anderen schon mit dem Auto
  rumfahren?

  Worum geht es eigentlich bei sdoc? Es ist eine Library, die dazu
  dienen soll, alle denkbaren Dokumente per Programm zu erzeugen. Also
  z.B. Rechnungen und Lieferscheine, aber auch einen Monatskalender,
  ein Adressbuch für die Westentasche, Barcode-Etiketten, ein
  Benutzerhandbuch, einen Weblog... (à la limite irgendwann auch mal
  ein Liederbuch mitsamt Noten und Akkorden... aber das mus ich mir
  noch überlegen.)

  Wieso generiere ich denn nicht einfach eine XML-Datei und lasse dann
  ein entsprechendes Tool laufen, das sie mir als Pdf rendert? Naja,
  weil ich kein so ein Tool habe...



20030602

- Tilt! renderer.onBeginEnvironment() ruft selber toStory() auf statt
  Elemente zurück zu geben. Oder evtl. e.getParent().toStory(). Der
  Renderer entscheidet also, was wohin kommt. So funktioniert es.

- started gandalf/docs/pds/main.pds

- http://www.perlpress.com/python/rtx.html:
  RTX -- An easy-to-use markup language for writers and documenters.
  RTX has two primary design
  goals: to be easy and unobtrusive to write and to be straightforward
  to machine process. RTX is a lot easier to type than docbook for
  example. And it can easily be converted into other formats, e.g.,
  HTML, SGML (docbook) and Lout (for postscript and pdf) using grtx.py
  or rtx.py.

20030603

- started web site and documentation using docutils.

- moved timtools to gandalf.timtools.
- moved version.py and releases.py from timtools to gandalf

- release 0.6.0 (nur intern)


20030604

- Das eigentliche Release von 0.6.0 verschiebe ich noch was. Ich muss
  mir noch überlegen, ob ich die Webseite mit docutils oder mit
  pds2html mache...

- Hmm... also ich müsste zumindest noch eine Funktion memo() bereit
  stellen, der man einen ganzen reStructuredText übergeben kann. Aber
  das ist nicht so leicht. Die docutils sind recht komplex, und der
  Parser funktioniert nur mit dem Datenmodell von docutils. Vielleicht
  sollte ich dieses Datenmodel fürs Dokument übernehmen?

- HtmlRenderer rendert jetzt schon besser.

- Body ist jetzt kein ElementContainer mehr, sondern Body.toStory()
  schickt direkt an Renderer.render() weiter. Der PdfRenderer sammelt
  die Elemente dann in einer weiteren _story, weil reportlab das ganze
  Dokument auf einmal kriegen will. Aber der HtmlRenderer schreibt die
  Elemente einfach weg und vergisst sie dann.

20030605

- Neue Funktion memo(). Arbeitet nicht mit einem echten XML-Parser,
  sondern ich habe selber einen geschrieben. Was man ja eigentlich
  nicht tun soll. Aber der XML-Parser von Python meldet z.B. ein
  fehlendes </li> als fatalen Fehler.

  tests/pds2pdf/20030605-memo funktioniert.

20030606

- Ein bisschen an logger.py weiter gebastelt.
- sendmail.py machte eine Exception wenn man falsche Parameter
  angegeben hatte und sie die Variable USAGE anzeigen sollte, die
  nicht definiert war.


20030609

- renamed gandalf.logger to gandalf.sandbox.
  renamed logger.py to anygui1.py
  new method console.notify()
  new module gandalf.misc.sound is used by console. If winsound is
  available, then a confirm() and a notify() will play the asterisk
  sound.

- anyguy1.py redirects the notifier so that messages appear in the
  form's message area instead of the console window.


20030610

- Weiter an adamo, der seit Kopenhagen (d.h. 20030404.py) im
  Kühlschrank war.


20030611

- Weiter an adamo. Reorganization of tests/adamo : 
  20030404 renamed to 1.py
  test_5 renamed to 2.py
  hello renamed to 3.py

- Class Skipper

- Query.setColumnList() ist noch nicht fertig.


20030614

- timtools/sendmail.py
  supports now if there is no username specified. It
  tries then to send the messages without a previous
  authentication.
  Problem was that pop.gmx.net had been reconfigured to refuse more
  than 10 messsages at once.
  
  There are still SMTP servers who not only don't require
  authentication but who don't support it: a SMTP.login() will result
  in the following answer::
  
    SMTP AUTH extension not supported by server.


- adamo weiter : 4.py, query.py

  Ich frage mich gerade, ob der primary key von Documents nicht besser
  ein einfaches id ist. Momentan ist er komplex : (jnl year seq). Wenn
  der primary key einfach nur id wäre, dann würden sich die Beispiele,
  die von InvoiceLines ausgehen, vereinfachen. Aber das allein ist ja
  kein Grund. Konkrete Auswirkung wäre z.B. im Fall von
  Pro-forma-Rechnungen oder allgemein wenn ein Dokument in ein anderes
  konvertiert werden soll. Vorläufig lass ich ihn al komplex, einfach
  um ein Beispiel von komplexem Primärschlüssel zu haben.

  new class Database

  CONTINUE HERE : tests/adamo : runme 1
    
  appendRow(), insertRow() : ein Query könnte das jetzt eigentlich
  selber schreiben. Statt obligatorisch über einen Skipper zu gehen.


20030617 sendmail.py machte nach 35 von 54 Fotos (ca. 11 Minuten)
folgende Exception::

  Traceback (most recent call last):
    File "t:\data\luc\release\gandalf\src\gandalf\timtools\sendmail.py", line 295,
   in ?
      SendMail()
    File "t:\data\luc\release\gandalf\src\gandalf\timtools\sendmail.py", line 103,
   in __init__
      self.processFile(filename)
    File "t:\data\luc\release\gandalf\src\gandalf\timtools\sendmail.py", line 229,
   in processFile
      self.sendto(msg,self.recipient)
    File "t:\data\luc\release\gandalf\src\gandalf\timtools\sendmail.py", line 257,
   in sendto
      self.server.sendmail(sender, (toAddr,), body)
    File "s:\python22\lib\smtplib.py", line 649, in sendmail
      (code,resp) = self.data(msg)
    File "s:\python22\lib\smtplib.py", line 452, in data
      (code,msg)=self.getreply()
    File "s:\python22\lib\smtplib.py", line 325, in getreply
      line = self.file.readline()
    File "s:\python22\lib\socket.py", line 238, in readline
      new = self._sock.recv(self._rbufsize)
  socket.error: (10054, 'Connection reset by peer')
  

20030618

- weiter an adamo. Jetzt habe ich zwar Atome eingeführt, aber immer
  noch ist das mitden Kolonnen unklar. Récapitulons. Die
  Adamo-Kolonnen entsprechen ja nicht unbedingt den physischen
  Kolonnen in der Datenbank. Das ist ja auch gewollt und muss so
  sein. Für jede Adamo-Kolonne gibt es eine Column-Instanz, und für
  jede "physische" Kolonne gibt es ein Atom. Atome müssen auch einen
  alias verwalten. Atom.__str__() kann nicht in SQL-Queries benutzt
  werden, weil je nach Kontext manchmal der echte Name, mal nur der
  Alias, und manchmal beide benötigt werden.
  Query.setOrderBy() erwartet eine (adamo)-columnList.

  
20030619

- weiter an adamo. Super! tests/adamo/1.py funktioniert jetzt.
  deleted 3.py
  renamed 4.py to 3.py

- started tests/pds2pdf/20030619-adamo.pds.
  Schade, dass
  from gandalf.sdoc.pdstools import testingExample
  nicht funktioniert, weil pds mit globals() arbeitet. Hm... muss ich
  noch was für finden.


20030620

- I changed my mind again: "Gandalf" is not a good project
  name. "Lino" is the name of the whole project. TIM tools are a part
  of Lino. Lino is the successor for TIM.

- renamed tests/pds2pdf to tests/pds

- ColumnContainer.addColumn() does now `col.container = self` so that
  a Column knows her container. Used by Detail.
  
- renamed components.py to columns.py

- sdoc is broken. After Jaanipäev I must continue with tests/pds.
  


20030625

- sdoc works again after an internal redesign 20030619.



20030626

- "from lino.sdoc.pdstools import showAndExec" works.
  At least partly.
  I am not yet very sure which global namespace to use. In fact it
  should be a unique dictionary for each Document.
  Currently I use commands.__dict__.
  
  The `conn` and `db` variables are created during showAndExec(),
  that's why they cannot be in the global dictionary of the .pds
  file. Can a method find out it's caller and modify the caller's
  module dictionary?

  Thats why I cannot use from pds.commands import *
  
- tests/pds/20030619-adamo.pds


20030627

- sandbox/mailboxes.py : a first etude for a mail archive reader.
  I tried to access my old Eudora mail with Mutt. It works, but Mutt
  says a strange warning "lock count exceeded"
  (see http://cygwin.com/ml/cygwin/2002-11/msg00628.html)

  Furthermore I have somewhere some old Netscape mailboxes.

  All I need is a little tool that can search for messages in all
  these mailboxes at once. Display a list with some selection
  possibility and some possibilities about what to do with these
  messages (print them, print a list of them, forward them,...)
  
- should I use the formatter module for sdoc? I did not know (or
  rather not remember) the existence of this standard module when I
  started working on sdoc.
  


20030703

- sendmail konnte man nicht benutzen, um Fotos von einer CD
  wegzuschicken, weil er dann mit einem IOError beendete, wenn er die
  Meldungen in die user.log schreiben wollte. Jetzt fängt er den
  IOError ab und schreibt dann eben keine log-Datei.

20030703

- working on tests/adamo/2.test02()

- Query.executeSelect() can now take an optional parameter columnList.

- I think that the internal representation of types will need some
  revision in the future. Although meanwhile it works like this. But I
  want to use the type definitions of the DBAPI. But I must extend
  them somehow because the DBAPI worries only about how to map a
  Python value to an SQL representation. But Adamo wants to know more
  than this. For example a type "Boolean" must exist because this will
  automatically lead to a CheckBox in a GUI window or HTML form.

- type.pt : at least there are now singleton instances of the most
  commonly used types (until now there was a new instance for each
  usage). Table.addField() and .addBabelField() have a slightly
  modified syntax : if more parameters than the type are present, then
  we call the (new) child() method on the given type.

- renamed IntelliRow to WritableRow

- row methods:
  new method Table.addRowMethod() and new class Callable
  (first example is Invoices.close())
  
- Query._slices is now a list of (col,value) tuples (was a dictionary
  of colname:value)

20030704

- Started implementation of automatic row numbering.
  adamo/tables.py : new method Table.getLastId()
  plugins/business.py : miscellaneous. The exact structure and
  collaboration between Journals and Documents is far from being
  definitive...

  
20030716

- new timtool "treecomp". Compares two directory trees and provides
  actions depending on the differences.  My plan is to use treecomp
  for making a zip file that I can create on my machine, based on the
  mirror of the customer and the new version. Then I send the zip
  file to the customer who just extracts it. [but how to delete files
  in the customer tree?]


20030717

- columns versus atoms.  An atom represents an "atomic" column. Atoms
  are the "real" columns used in the SQL query.  Columns otoh are the
  user-given Adamo names and will result in an attribute of a row.
  Atoms are invisible to the user.  Adamo column names should never
  contain any underscore because the underscore is used by the mapping
  system. If you call query.setColumnList("partner_name"), then you
  will receive rows with an attribute "partner_name", but the
  underscore indicates that Adamo does some conversion behind the
  scene.

20030718

I am still locked with the mapping row2atoms() and atoms2row().

- atoms2row() could be renamed to atoms2value() and return a value.
  Instead of filling them into a Column.

- Is a Detail a Column?  It is surprising that Details are considered
  columns in Adamo.  Instead of being a Column, they could also be in
  a separate list like rowMethods.  It is true that they are quite
  special columns:
  - their "values" in a row are queries.
  - they don't produce any atoms
  
  The idea is that a report on a query can have columns
  where each cell contains the result of a query.
  
  Example:
    
  ===== ======= ================================================
  id    author  publications
  ----- ------- ------------------------------------------------
  1     hugh    "me & miss wray", "Negotiations and lovesongs",
                "West of Eden"
  2     jacques "Les Marquises", "Jojo", "Ne me quitte pas", ...
  ===== ======= ================================================

  If Details are considered columns, then rowMethods should also be.
  In a HTML report they could be represented as a link or button on
  each row.

  Sowieso : wieso habe ich eigentlich QueryColumn und TableColumn
  zusammengelegt?  Weil es die gemeinsame BaseClass ColumnContainer
  gibt.  Scheinbar weil ich wollte, dass eine Table ihr eigenes Query
  für peek() machen kann.  Das war falsch.

  Naja, so dumm war es vielleicht nicht:
  - Siehe Pointer.setupAtoms und Pointer.row2atoms()
  - Siehe Table.getPrimaryAtoms()

  Eine QueryColumn muss setupAtoms(cnt) und row2atoms(row,atomicRow)
  und atoms2value(atomicRow) implementieren. Sie muss also ihre Atome
  speichern. 


  
20030722 New Design considerations

  - Field, Pointer und Detail werden wieder zu Components, bzw. besser
    gesagt, TableAttribute, oder noch besser: RowAttribute.
    Table._attrs ist ein dict, der diese Namen als Keys enthält.
    
  - Column._atoms nur in QueryColumns.
  - Zwecks peek() hat jede Tabelle ein spezielles Query instance,
    damit nicht für jedes peek() ein Query instanziert werden muss.

  - Column.container ?

  - Queries and Tables

    Each QueryColumn represents a RowAttribute.
  
    [todo] Should there be subclasses of QueryColumn, one for each
    RowAttribute class?  Because it is quite a big difference whether
    a QueryColumn represents a Detail or a simple Field, or a
    RowMethod...

  - Mapping between object and tuple

  Bisher war eine BaseRow immer mit einem ColumnContainer verbunden.
  Jetzt ist sie mit einer Table verbunden.  Aber wie soll denn das
  Mapping funktionieren?

  Ein Query mappt überhaupt nicht selber, sondern per-attribute access
  gibt es nur für Row-Instanzen, und die sind immer nur in einer
  Tabelle. Query-Kolonnen haben keinen Namen, sondern können nur über
  ihren Index angesprochen werden.

  Atoms represent an "atomic" SQL column.  Each Query contains and
  manages a list of Atoms.
  
  When a Query is built, each QueryColumn of the Query asks her
  RowAttribute to specify a list of atomic names required for this
  attribute::
  
     RowAttribute.getNeededAtoms()
  
  RowAttribute.getNeededAtoms() decides which Atoms are needed:
  
  - Fields need exactly one Atom
  - Pointers need one to several atoms (those who represent the
    pointed table's primary key)
  - Details, Vurts, RowMethods don't need any atoms at all.
  
  [obsolete] RowAttribute.getNeededAtoms() calls query.provideAtom()
  who creates them if they are not already present.
  
  [new] RowAttribute.getNeededAtoms() returns a sequence of
  (name,type) pairs. The atomic name will possibly be prefixed with
  the Table's alias in the SQL query.

  Although the atoms themselves are created by the Query and also
  stored there in a list variable Query._atoms, each QueryColumn keeps
  a list of (pointers to) those atoms who were necessary for mapping
  her RowAttribute.  The RowAttribute will need this list for
  mapping.
  
  
  - Tuple to object mapping
  
    Query.provideRow(atomicRow) asks the leadTable to make a row
    instance, then asks each column to fill her atoms to this row's
    dictionary::
    
      RowAttribute.atoms2value(self,atomicRow,columnAtoms)

    returns the value of this attribute in a row to be instanciated
    from atomicRow, which was made using columnAtoms as
    attribute-specific atoms.
    
      for a in columnAtoms:
        atomicRow[a.index]

  - Object to tuple mapping::
  
      Atom.getValue(self,row)
      
    returns the value of this atom in the specified row.

    Examples :
    
    - the atom "document.jnl_id" in a query "SELECT ...
      document.jnl_id ... FROM lines LEFT JOIN document ..."  will
      work like this::
    
        document = getattr(row,"document")
        return getattr(document,"jnl_id")

    - the atom "partner.name" in a query "SELECT ... partner.name
      ... FROM lines LEFT JOIN document ... LEFT JOIN partner ..."
      will work like this::
      
        document = getattr(row,"document")
        partner = getattr(document,"partner")
        return getattr(partner,"name")

    - SELECT partner.id, lead.partner_id ... from Invoices as lead
      LEFT JOIN Partners as partner ON (lead.partner_id = partner.id)

      (both atoms will always have the same value)

    Or, more generic::
    
        join = self.join
        while join:
           row = getattr(row,join.name)
           join = join.parent
        return getattr(row,self.name)


  - Nobody is perfect
  
  A row instance does not necessarily contain all the persistant data
  of the row.  It can have an _uncomplete_ picture of the row.

  It knows at least the primary key.  If BaseRow.__getattr__() is
  asked for an unknown attribute (but which is a valid
  RowAttribute), then the row instance does a peek() and fills her
  data to become "complete".

  The peek() is triggered only once, by the first unknown attribute.
  Since a peek() provides all fields at once with a single SQL query,
  the row will be "complete" after this. There is no need to do
  another peek() later.

  BaseRow.__getattr__() and BaseRow.peek()
  
                
- TODO :

  - tests/adamo/2.py : Pointer.row2atoms() seems to not work correctly::

      DatabaseError: INSERT INTO INVOICELINES ( line, unitPrice, qty,
      remark, invoice_jnl_id, invoice_seq, product_id ) VALUES ( 2,
      NULL, 3, NULL, JOURNALSRow <{'tableName': 'INVOICES', 'id': 1,
      'name': 'outgoing invoices'}>, 1, NULL ) unrecognized token: "{"

  - Query.appendRow() should automatically use Table.getLastId()+1 if
    the last atom of the primary key is not specified (and if type is
    ROWID)

  - in pds.pds ist der Autor nicht zentriert







20030730

- epydoc 2.0 now supports reStructured text. That's why I had a look
  at it.

  epydoc is an API documentation generator with its own markup
  language (for example L{ClassName} to insert links. But it supports
  other docstring formats. It imports the modules for whom to write
  documentation, then parses their docstrings, collecting the
  documentation in a big dictionary.  
  
  The command-line-interface sits in a separate file cli.py.
  It comes with a nice Tkinter GUI.

- [url http://happydoc.sourceforge.net/ HappyDoc] does the same as
  epydoc... only different.

- [url http://docutils.sourceforge.net/FAQ.html#python-source-reader]

  Version 2.0 of Ed Loper's Epydoc supports reStructuredText-format
  docstrings for HTML output. Docutils 0.3 or newer is required.
  Development of a Docutils-specific auto-documentation tool will
  continue. Epydoc works by importing Python modules to be documented,
  whereas the Docutils-specific tool, described above, will parse
  modules without importing them (as with HappyDoc, which doesn't
  support reStructuredText).


- Using Queries

  1. The leadTable is mandatory in __init__()
  
  2. specify the columns using __init__() or setColumnList() (or,
     later, with individual addColumn() calls)
     
  3. setupAtoms() works out the list of atomic SQL columns needed by
     the Query. (Called automatically by setColumnList())
     
  addColumn() must be locked after Query.setupAtoms() because the
  atomic names of the columns depend on hasJoins(). 



20030731

- Idee : the value of a Detail is not a Query, but something
  between. Something which can make a Query.  How to name them?

- Mapping between object and atomicRow.

  An atomic row is always together with a Query: if you have an atomic
  row but not the Query which was used to get this row, then your
  atomic row is just a tuple without any meaning.  The query can turn
  this tuple for you into an object: Query.provideRow(atomicRow)
  returns an instance of a "real" row of leadTable (that is, a
  subclass of WritableRow)

  Query.provideRow(atomicRow) works like this: it asks the query's
  leadTable to provide a Row instance, then asks her QueryColumns to
  fill this row with values from the atomic row::
  
     for col in self._columns:
        col.atoms2row(atomicRow,rowInstance)

- Row instanciation. Table.provideRow(rid) returns an instance of the
  row with specified rid (where rid is a tuple of values, one for each
  atom of the primary key of this table). rid is mandatory. If the
  instance is in cache, then this one is returned.  Otherwise a new
  object is instanciated and stored to cache before returning it.

  
- Caching.  If a query requests the instance of a row which is already
  in cache, then the cached row is used, after updating its values
  with those provided by the Query. There could be a integrity check
  here if the row is not dirty: the known values of the row must be
  the same as those known by the Query.

  Example ::
  
    q1 : SELECT name, fname from Partners where id = 1
    atomicRow = q1.fetchone()
    p1 = q1.provideRow(atomicRow)
    q2 : SELECT name, city from Partners where id = 1

  q2 will get the cached Partners row. This row will know her fname
  attribute although it was not included in q2, because this attribute
  was given by q1.

  (Of course : Caching in general means that every database access
  must be done through one single server process.)
    


  
- What is Adamo? Why Adamo?  Is Adamo a reinvented wheel?

  Adamo provides a level of abstraction that I (1) did not find
  anywhere else and (2) perceive as necessary. 

20030803

::

  c:\Lino>cvs -d:pserver:lsaffre@@cvs.sourceforge.net:/cvsroot/lino login
  Logging in to :pserver:lsaffre@@cvs.sourceforge.net:2401/cvsroot/lino
  CVS password:
  
  c:\Lino>cvs -d:ext:lsaffre@@cvs.sourceforge.net:/cvsroot/lino import -m "Initial import" lino lsaffre start
  > cvs.sourceforge.net:Zeitlimit für Verbindung erreicht
  cvs [import aborted]: end of file from server (consult above messages
  if any)

  
20030805

- Wow! tests/adamo läuft nach langer Zeit endlich mal wieder (fast).


20030806

Habe in den SF Doku gestöbert, um den CVS import zu machen:

  "Before a developer may access their CVS repository, they must first
  connect once, via an interactive SSH session, to the project CVS
  servers as to have their home directory created."

Also:


  T:\data\luc\release\lino>ssh -l lsaffre cvs.sourceforge.net
  lsaffre@@cvs.sourceforge.net's password:
  Creating home directory '/home/users/l/ls/lsaffre'.

  Welcome to cvs.sourceforge.net

  This is a restricted Shell Account
  You cannot execute anything here.

  Connection to cvs.sourceforge.net closed.

  T:\data\luc\release\lino>

Aber das war's noch immer nicht.

Hier der nächste Hoffnungsschimmer: Logisch!

  "Access to the project CVS servers is provided via SSH (for
  developers) and the CVS pserver protocols (for non-developers). SSH
  uses TCP port 22; CVS pserver uses TCP port 2401. Many firewalls
  block outbound traffic on these ports, thus preventing
  SourceForge.net developers and users from accessing the project CVS
  servers."

Ob ich das mit der Konfiguration meines Routers geregelt kriege?   



20030808

- tests/adamo/1.py and addrbook.py : the row method "getName"
  overrides the table method getName().
  
  Design problem : row methods should perhaps not be methods of the
  table.

  (?) row.py : BaseRow.__getattr__() does not find 'getRowName' in
  ORGS._rowAttrs because this attribute is inherited.
  

20030814

On http://freebsdhowtos.com/77.html?%22 I found the missing hint: I
must set CVS_RSH=ssh frst::

  cvs -d:pserver:lsaffre@@cvs.sourceforge.net:/cvsroot/lino login
  set CVS_RSH=ssh
  cvs -d:ext:lsaffre@@cvs.sourceforge.net:/cvsroot/lino import -m "Initial import" lino lsaffre start

Now the import worked!

... allerdings hätte ich .cvsignore zuvor besser in alle Verzeichnisse
reingetan, denn es gilt nicht rekursiv...
  


20030815

- makeComplete() does not work correctly : if fills using the atoms,
  but it must use column.atoms2row()
  
- abandon Details as RowAttributes?
  See be.cities : it is so easy to do what the Detail does. Just
  setSlice() 


20030816

- Wow! tests/adamo works now really almost! getRowId() gibt jetzt
  immer nur reine Atome zurück, statt wie bisher ein tuple von
  values.

- how to remove all `*.pyc` from local copy and cvs ::
  
     find . -name "*.pyc" > tmp.lst
     cat tmp.lst | xargs rm
     cat tmp.lst | xargs cvs remove
     del tmp.lst
     cvs commit -m "removed *.pyc"
     
  
20030817 Sunday

- Query.appendRow() machte einen Fehler, wenn das letzte Atom
  automatisch erstellt werden musste UND der primary key auch pointers
  enthielt. Behoben.

20030818  Monday

- Query.__iter__() and QueryIterator().
  Table.__getitem__()
  Table.provideRowInstance()

- Wann soll partner.name von partner.org.name
  bzw. partner.person.getRowName() übernommen werden?

  Should WritableRow.unlock() fail (and leave the row locked and
  so-to-speak refuse the unlock operation) if validateRow() raised an
  Exception?  (Either by not catching the Exception or by catching it
  and returning True/False)? Or should it always unlock the row, even
  if it is not valid? But what to do with an invalid unlocked row?
  What if the user presses [Alt-F4] when such a row exists? In a real
  database system this is handled by transactions: the
  whole transaction won't commit as long as there is at least one
  invalid row.

  Am I really going to write a complete database server with
  transactions? 

  http://j2ee.masslight.com

  Should validateRow() be able to modify a row? to validate =
  bestätigen, für gültig erlären.  Also validateRow darf nichts
  ändern, sondern prüft nur nach. Wird auch vom Integritätstest
  benutzt.

  Idee : neue Method finishRow() darf keine Ausnahme aufwerfen, darf
  aber dafür noch im Record "nachbearbeiten".

  Quatsch : Eigentlich gar nicht erst in Row.unlock(), sondern sobald
  eines der beiden Felder bearbeitet wurde. Also im afterEdit() des
  RowAttributes. Und zwar eigentlich auch in appendRow().

20030819 Tuesday

- cvs commit


20030820 Wednesday

- I published some first HTML pages at
  http://lino.sourceforge.net.
  Rather to see whether it works--- not so much because their content
  were important.

20030822 Friday

- moved the content of `lino.apps` to `lino.sprl`.
  `lino.plugins` becomes a subdir of this : `lino.sprl.plugins`.
  
  `lino.sprl`. lino.sprl will be a package whose modules are those
  defined currently in `lino.plugins`
  
  from lino.sprl

20030824 Sunday. Started but not finished

  - move lino-diary.txt to docs/ and make some blog-like diary.  Split
    diary : `news.txt` with the latest news and move older news to
    archives named `yyyy-mm.txt`.
    
  - `run_tests.py` should run all tests and confirm "with a
    mouse-click and a cup of coffee" that everything is okay.

20030830 Saturday

- Had a look at http://www.scons.org which I would like to use as
  `make` tool for some tasks:
  
  - building .html from .txt using docutils
  - executing tests using doctest
  - uploading html files
  - committing source files

  Hmm... it seems more work to start using SCon than to write the
  scripts myself... 


20030902 

It is time to start a user interface.  Web application or GUI? -> Web
application first, GUI later.

- http://cheetahtemplate.org/ is at 0.9.15

- http://webware.sourceforge.net/ is at 0.8.1 since January

Wow! Here it is, the wheel which I am reinventing! Webware has a
"MiddleKit" component which I did not know about so far!
Adamo tries to do almost the same!

I should now rather develop some Webware applications before
continuing on Adamo...


20030903

- Worked on `run_tests.py` which I should soon rename to
  `make.py`. Pity that the code in `docutils/tools/buildhtml.py` is
  not available for import. Docutils has a very, VERY sophisticated
  system to process the different options (`settings` parameter of
  `Publisher` class).

20030904

- Continued `run_tests.py`. Copied buildhtml.py to `lino.misc`.

- Despite docutils' sophisticated configuration system I cannot
  directly configure the resulting html by specifying my own
  template.

- Okay, I could write something similar to `pep2html.py`.
  `pep2html` uses %-formatting which is too simple.
  What I want is to specify my template with embedded python
  code... 

20030906

- tests/pds/20030619-adamo.pds was broken. Now its fixed. Not yet very
  beautifully...

- todo in tests/pds :

  - `20030413-header.pds` : headers are rendered at the end of the
	 document instead of on top of each page. (bug fixed 20031002)
    
  - setTitle() comes too late : title is still empty when html page
    header is created
    
20030909

- added misc/compat.py so that I can write::

    from lino.misc.compat import *

  True and False are known only since Python 2.2, but Lino should
  better run also on older installations. Debian comes with 2.1.

- added `sprl/Properties.py` so that lino.sprl can act as a Webware
  plugin.

- `run_tests.py` now supports if there is no `docutils` package.

- linefeeds are still wrongly converted at some place. `run_tests.py`
  still fails because doctest doesn't like DOS- linefeeds on UNIX. 

20030910

- added `docs/install.txt`.


20030911

`tests/adamo/3.py`: the new `test04()` did not work on hour ago::

    PERSONS.appendRow(fname="Harry",name="Potter")
    PERSONS.appendRow(fname="Harry",name="Bellafonte")

If appendRow() had to determine the auto-incrementing id AND no
commit() was made after a first appendRow(), then adamo did not
increment.  Because the auto-incrementing id was always determined by
an SQL query. Since the first row was not yet committed, the query
returned the same id again. Solution : the Table now also caches the
lastId since it caches rows.

- `python make.py` does now also the unittests in `tests`

- moved `barcodes.py` `test_pgdb.py`, `sqlite_test.py` and
  `20030421.py` from `tests/etc` to `src/sandbox`


20030912

- Wow! Within less than two hours I made a fundamental design change
  (which was necessary) for defining tables. 

- started Table.find() and Query.setFilter(). Not finished.


20030916 Project Status

- Worked on the Lino website.

- New files `sandbox/pizzeria.py` `docs/pizzeria.txt`


- make.py now runs `em.expand()` on each txt file before running
  `publish_string()`. 
  removed `src\lino\misc\buildhtml.py`.
  `make.py` now no longer generates html files if they are up-to-date.

  Note : i added empy processing because I wanted to include
  `pizzeria.py` into `pizzeria.txt`. Afterwards I discovered the
  `include` directive. 

- (cancelled 20030917) The generated html is now in a separate
  directory tree `html`.

- TODO : ``cvs add html``. But what about lino.css, and .cvsignore files
  in this tree? How to clean the tree, for example if a directory
  under docs no longer exists... Perhaps it is better to not separate
  the two trees... merge them back. And also display source link
  again.

20030917

- `make.py` : don't separate docs/ and html/. Removed directory html/
  again. 

- TODO : `make.py` should read a `docutils.config` file. Or even my
  own enhanced config file where I can specify whether a file should
  be preprocessed by empy or not. And specify a page
  template. Although there is also the `::sidebar` directive in
  docutils...
  
- `make.py` now has a (non-default) target `upload`.
   removed `docs/upload.bat` which is now obsolete.


20030918

- I abandoned temporarily to get Lino running on my Debian
  system.  After running `to-woody` I cannot install new packages
  anymore...

- I found "Snakelets" by Irmen de Jong.  Within a few hours I had a
  first proof-of-concept Lino Web Application running! Benefit of
  using Snakelets (a standalone Web server) is that installation is
  now very easy.

- A first "enhancement" in `snakeserver/server.py`: added a "shutdown"
  button in `MyRequestHandler.reportSnakeletException()`


20030919

- Now I am trying to gather my ideas about an "abstract GUI" :
  Windows and Components.  The long-term goal 

- Another modification in snakeserver/server.py : ThreadingServer has
  now an attribute `serverRoot` which is used by my `serv.py` to put
  webapps and pageCache to another directory.

20030920

- New documentation file `docs/wui.txt` tries to give an overview of
  the WUI.
  
- If a user opens several browsers at the same, they all get the same
  session. The Windows of a session must be stored in a list, and a
  session-specific windowId passed through the URL.

  Examples:
  
  - `menu.sn` : open a new main window (returned from the database)
  
  - `menu.sn?w=7` : displays window 7
  
  - `menu.sn?a=1` : specifying an action without the window is not
    allowed.
  
  - `menu.sn?w=1&a=2` : executes action 2 of window 1, then displays
    the next window as returned by action.

  
20030922

- Das Grid muss hier eigentlich Referenzen einfügen... aber beim
  Rendern darf ich doch keine neuen Aktionen erstellen! Das muss
  vorher passieren! Oder wie?  Ein UI müsste auch beim Rendern
  Aktionen definieren dürfen, die dann nicht zum Window gehören,
  sondern nur bis zum nächsten Request gültig sind...
            
- Unterschied zwischen HtmlRenderer und SnakeUI wird mir jetzt erst
  langsam klar.

20030923

- The `snake` Web interface has some early results::

    cd $LINOROOT/snake
    python serv.py
    http://localhost:9080
    
  (The first page comes from Irmen de Jong's Snakelets. Click on
  'Lino' to see Lino)

  Things that work:

  - The main and admin menus of the database display (not beautifully,
    but clickable). Exception : System | shutdown
  
  - Displaying queries
  
  - Sorting a query by clicking on the column title
  
  But I am not confident whether this is the right way to do it. I
  think I will have a look at Twisted soon...

20030925

- Another minor change in `snakeserver/server.py`: if a directory
  `CVS` exists in the webapps directory,  then the import failed
  because there is of course no __init__.py in this directory. The
  failed import then tried to remove abspath from `sys.path` where it
  had never been...

- Changed names `MenuSnakelet` and `menu.sn` to MainSnakelet and
  `main.sh`.


20030930

- merged ui.WindowManager to UI. Windows can now be much more than
  "Window" instances. Renderer.renderWindow() is free to render any
  object. For example a Row could be rendered as is... no need to make
  a Window for this. A Grid however is an Editor for a Query. Maybe
  there must also be a RowEditor?

- New TIM tools "openurl" which is very simple. Here is the complete
  code::

	 import sys,webbrowser
	 for url in sys.argv[1:]:
	    webbrowser.open(url,new=1)

  TIM (or any other command-line application) can use it to open a Web
  address using the user's default browser::
  
    timtools openurl http://lino.sourceforge.net
	 
  
20031002

- pds2pdf again handles page headers correctly (see 20030906)

- The `TIM tools page <timtools.html>`_ has now some content.
  Worked on the docstrings of these tools. Replaced -? by -h since
  -? is not automatically recognized as a possible command-line option
  by docutils.


20031004

- lino/adamo : renamed `type.py` to `datatypes.py`. 

20031008

- command-line option -b (--batch) now also for prn2pdf.


20031010

- I am moving from Snakelets to Quixote as Web Framework.  Quixote can
  integrate into Apache or other Web servers, but most easy for me is
  to use Medusa.

  Just start `src/lino/quix/serve.py` and point your browser to
  http://localhost:8080

  
20031016

- during the last days I worked much on 

20031018

- new example `voc.py` in `src/lino/examples`. This is going to be a
  kind of vocabulary database.

- lino/adamo/connection.py : new class MemoryConnection

- Design changes :

  - Connection is now instantiated before Database. Before
	 instanciating a Database, you must create the connection to be
	 used for the default storage

  - addPointer() now (finally) no longer needs a convention about how
    the tables are actually named. It looks up the pointed-to table
    using the class it must implement.
    New method `Database.findImplementingTables()`.

  
