<?xml version="1.0" encoding="latin-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=latin-1" />
<meta name="generator" content="Docutils 0.3.6: http://docutils.sourceforge.net/" />
<title>Pizzeria</title>
<link rel="stylesheet" href="../default.css" type="text/css" />
</head>
<body>
<table class="mainTable">
			<tr>
			<td valign="top" class="leftArea">
				<p class="menu">
	<a href="index.html">Home</a>
	<br><a href="http://sourceforge.net/projects/lino/">Forge</a>
	</p>
	
	<p class="copyright">
	&copy; 2001-2004
	<br><a href="mailto:luc.saffre@gmx.net">Luc Saffre</a>
	<br>
	
	<br><a href="http://sourceforge.net">
	<img src="http://sourceforge.net/sflogo.php?group_id=87016&type=1"
   width="88" height="31" border="0" alt="SourceForge.net Logo" /></a>
	</p>
	<br>&nbsp;&nbsp;<a href="../overview.html">overview</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="adamo.html">adamo</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pizzeria<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="intro.html">intro</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="tim2adamo.html">tim2adamo</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../timtools.html">timtools</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../scripts.html">scripts</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../wui.html">wui</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../webman.html">webman</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../pds/pds.html">pds</a><br>&nbsp;&nbsp;<a href="../faq.html">faq</a><br>&nbsp;&nbsp;<a href="../links.html">links</a><br>&nbsp;&nbsp;<a href="../install/install.html">install</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../install/download.html">download</a><br>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../install/_oops.html">start</a><br>&nbsp;&nbsp;<a href="../start.html">start</a><br>&nbsp;&nbsp;<a href="../history.html">history</a><br>&nbsp;&nbsp;<a href="../todo.html">todo</a></td>
			<td class="textArea"><h1 class="title">Pizzeria</h1>
<div class="document" id="pizzeria">
<p>The file <cite>src/lino/examples/pizzeria.py</cite> is a simple example to
introduce Adamo.</p>
<div class="section" id="first-day">
<h1><a name="first-day">First day</a></h1>
<p>Here is the source code:</p>
<blockquote>
<pre class="literal-block">
#coding: latin1
#----------------------------------------------------------------------
# $Id: pizzeria.py,v 1.10 2004/06/12 03:06:51 lsaffre Exp $
# Copyright: (c) 2003-2004 Luc Saffre
# License:	 GPL
#----------------------------------------------------------------------

&quot;&quot;&quot;
This is a short example to illustrate Adamo's basic idea.

&quot;&quot;&quot;

from lino.adamo import *

from forum.normalDate import ND

# 1. Define the database schema


#from lino.adamo.schema import DatabaseSchema, quickdb

class Products(Table):
	def init(self):
		self.name = Field(STRING)
		self.price = Field(PRICE)

class Customers(Table):
	def init(self):
		self.name = Field(STRING)
		self.street = Field(STRING)
		self.city = Field(STRING)

	 
class Orders(Table):
	def init(self):
		self.date = Field(DATE)
		self.customer = Pointer(Customers)
		self.totalPrice = Field(PRICE)
		self.isRegistered = Field(BOOL)
		
	class Row(Table.Row):
		def register(self):
			self.lock()
			totalPrice = 0
			for line in self.lines:
				#print line
				assert line.ordr.id == self.id
				totalPrice += (line.qty * line.product.price)
			self.totalPrice = totalPrice
			self.isRegistered = True
			self.unlock()
	  
	 
class OrderLines(Table):
	def init(self):
		self.ordr = Pointer(Orders)
		self.product = Pointer(Products)
		self.qty = Field(INT)
		self.ordr.setDetail('lines')
		
	class Row(Table.Row):
		def validate(self):
			if self.ordr is None:
				return &quot;order is mandatory&quot;
			if self.product is None:
				return &quot;product is mandatory&quot;


class BasePlugin(SchemaPlugin):
	def defineTables(self,schema,ui):
		schema.addTable( Products(&quot;PROD&quot;))
		schema.addTable(Customers(&quot;CUST&quot;))
		schema.addTable(Orders(&quot;ORDERS&quot;))
		schema.addTable(OrderLines(&quot;LINES&quot;))
		
def Pizzeria():
	schema = Schema()
	schema.addPlugin(BasePlugin())
	return schema

		
		
def populate(sess):
	&quot;&quot;&quot;
	Create some data and play with it
	&quot;&quot;&quot;
	sess.installto(globals())
	
	c1 = CUST.appendRow(name=&quot;Henri&quot;)
	c2 = CUST.appendRow(name=&quot;James&quot;)

	p1 = PROD.appendRow(name=&quot;Pizza Margerita&quot;,price=6)
	p2 = PROD.appendRow(name=&quot;Pizza Marinara&quot;,price=7)

	o1 = ORDERS.appendRow(customer=c1,
								 date=ND(20030816))
	LINES.appendRow(ordr=o1,product=p1,qty=2)


	o2 = ORDERS.appendRow(customer=c2,date=ND(20030816))
	LINES.appendRow(ordr=o2,product=p1,qty=3)
	LINES.appendRow(ordr=o2,product=p2,qty=5)

	sess.commit()

	o1.register()
	o2.register()

	sess.commit()
	

def query(sess):
	&quot;&quot;&quot;
	Create some data and play with it
	&quot;&quot;&quot;
	sess.installto(globals())
	
## 	q = ORDERS.query(&quot;customer totalPrice&quot;)
## 	for (customer,totalPrice) in q:
## 		print &quot;%s must pay %d EUR&quot; % (customer.name,totalPrice)
	for o in ORDERS.query(&quot;customer totalPrice&quot;):
		print &quot;%s must pay %d EUR&quot; % (o.customer.name,
												o.totalPrice)

def main():

	db = quickdb(schema=Pizzeria(),
					 isTemporary=True,
					 label=&quot;Lucs Pizza Restaurant&quot;)

	# create empty tables
	db.createTables()
	
	sess = ConsoleSession(db=db)
	#sess.beginContext(db.beginContext())

	# play around
	populate(sess)
	sess.commit()
	
	query(sess)

	# commit changes and release the database file
	sess.shutdown()
	
if __name__ == &quot;__main__&quot;:
	main()

</pre>
</blockquote>
<p>&#64;{
from lino import __version__
}</p>
<p>Here is what you see if you run pizzeria:</p>
<pre class="literal-block">
&gt;&gt;&gt; from lino.examples.pizzeria import main
&gt;&gt;&gt; main()
Lino version 0.5.5
Copyright (c) 2002-2004 Luc Saffre
This software comes with ABSOLUTELY NO WARRANTY.
Distributed under the terms of the GNU General Public License.
See file COPYING.txt for more information.
Adamo startup...
  Initializing database...
  Initializing 4 tables...
Adamo startup okay
Henri must pay 12 EUR
James must pay 53 EUR
</pre>
<p>You can get the same output by simply running the <cite>pizzeria.py</cite> script
from the command-line.</p>
<p>TODO: add some explanations</p>
</div>
</div>
</td></tr></table></body>
</html>
<div class="bottomArea"><p class="footer">This page was generated on Fri Sep 24 13:47:32 2004 by Lino <a href="webman.html">WebMan</a> version 0.6.2pre.</div>